buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "gradle.plugin.com.github.sherter.google-java-format:google-java-format-gradle-plugin:0.9"
    }
}

plugins {
    id 'java'
    id 'application'
    id('io.dinject.openapi') version('1.2')
}

repositories {
    mavenCentral()
    maven {
        url 'https://oss.sonatype.org/content/repositories/snapshots'
    }
}

dependencies {
    implementation 'io.github.clightning4j:jrpclightning:0.2.0'
    implementation 'com.google.code.gson:gson:2.8.7'

    compile 'io.javalin:javalin:3.13.9'
    compile 'io.javalin:javalin-openapi:3.13.9'
    compile 'io.javalin:javalin-bundle:3.13.9'
    compile 'io.swagger.core.v3:swagger-core:2.1.10'
    compile 'org.webjars:swagger-ui:3.51.1'
    compile 'com.squareup.okhttp3:okhttp:4.9.1'
    compile 'com.squareup.moshi:moshi-adapters:1.12.0'
    compile 'io.dinject:dinject:2.3'
    compile 'io.dinject:dinject-controller:1.22'

    annotationProcessor 'io.dinject:dinject-generator:2.3'
    annotationProcessor 'io.dinject:javalin-generator:1.22'
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.11.1'

    testImplementation 'com.squareup.okhttp3:okhttp:4.9.1'
    testImplementation 'org.mockito:mockito-core:3.11.2'
    testImplementation 'junit:junit:4.13.2'
    testImplementation 'com.konghq:unirest-java:3.11.12'
    testImplementation 'org.assertj:assertj-core:3.20.2'
    testImplementation 'ch.qos.logback:logback-classic:1.2.5'
    testImplementation 'ch.qos.logback:logback-core:1.2.5'
    testImplementation 'org.slf4j:slf4j-api:1.7.32'
}

jar {
    manifest {
        attributes(
                'Class-Path': configurations.compile.collect { it.getName() }.join(' '),
                'Main-Class': 'io.vincenzopalazzo.lightning.App'
        )
    }

    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

task createRunnableScript {
    dependsOn("jar")
    file("${projectDir}/${project.name}-gen.sh").createNewFile()
    file("${projectDir}/${project.name}-gen.sh").write(
            """# Script generated from gradle! By clightning4j
#!/bin/bash
${System.getProperties().getProperty("java.home")}/bin/java -jar ${project.buildDir.absolutePath}/libs/${project.name}.jar
""")
}

application {
    // Define the main class for the application.
    mainClassName = 'io.vincenzopalazzo.lightning.App'
}
