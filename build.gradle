plugins {
    id 'java'
    id 'application'
    id('io.dinject.openapi') version('1.2')
}

repositories {
    mavenCentral()
    maven {
        url 'https://oss.sonatype.org/content/repositories/snapshots'
    }
}

dependencies {
    //implementation name: 'jrpclightning-0.1.9-SNAPSHOT-with-dependencies'
    implementation 'io.github.clightning4j:jrpclightning:0.1.9'
    implementation 'com.google.code.gson:gson:2.8.6'

    compile 'io.javalin:javalin:3.9.1'
    compile 'io.javalin:javalin-openapi:3.9.1'
    compile 'io.javalin:javalin-bundle:3.9.0'
    compile 'io.swagger.core.v3:swagger-core:2.0.9'
    compile 'org.webjars:swagger-ui:3.24.3<'
    compile 'com.squareup.okhttp3:okhttp:4.3.0'
    compile 'com.squareup.moshi:moshi-adapters:1.9.2'
    compile 'io.dinject:dinject:1.14'
    compile 'io.dinject:dinject-controller:1.14'

    annotationProcessor 'io.dinject:dinject-generator:1.14'
    annotationProcessor 'io.dinject:javalin-generator:1.14'
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.11.1'

    testImplementation 'com.squareup.okhttp3:okhttp:4.8.1'
    testImplementation 'org.mockito:mockito-core:3.5.10'
    testImplementation 'junit:junit:4.12'
    testImplementation 'com.konghq:unirest-java:3.10.00'
    testImplementation 'org.assertj:assertj-core:3.11.1'
    testImplementation 'ch.qos.logback:logback-classic:1.2.3'
    testImplementation 'ch.qos.logback:logback-core:1.2.3'
    testImplementation 'org.slf4j:slf4j-api:1.7.25'
}

jar {
    manifest {
        attributes(
                'Class-Path': configurations.compile.collect { it.getName() }.join(' '),
                'Main-Class': 'io.vincenzopalazzo.lightning.App'
        )
    }

    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

task createRunnableScript {
    dependsOn("jar")
    file("${projectDir}/${project.name}-gen.sh").createNewFile()
    file("${projectDir}/${project.name}-gen.sh").write(
            """# Script generated from gradle! By clightning4j
#!/bin/bash
${System.getProperties().getProperty("java.home")}/bin/java -jar ${project.buildDir.absolutePath}/libs/${project.name}.jar
""")
}

application {
    // Define the main class for the application.
    mainClassName = 'io.vincenzopalazzo.lightning.App'
}
